import{R as P,e as i,I as A,_ as H,k as W,af as k,m as e,n as $,L as C,aa as G,ai as u,aw as J,O as R,ak as y,N as f,au as Q,ar as X,av as Y}from"./index-FD1T5Q2O.js";import{S as O,P as Z}from"./index-DV0-gRm5.js";import{T as ee}from"./index-Bw-ri7r9.js";import{E as se}from"./modal-8NwfAtd_.js";import"./Combination-C62u9g4Y.js";import"./b-tween.es-BtQQsX34.js";function N(t,o){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);o&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),r.push.apply(r,n)}return r}function U(t){for(var o=1;o<arguments.length;o++){var r=arguments[o]!=null?arguments[o]:{};o%2?N(Object(r),!0).forEach(function(n){W(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function te(t,o){var r=i.useContext(A),n=r.prefixCls,c=n===void 0?"arco":n,h=t.spin,j=t.className,d=U(U({"aria-hidden":!0,focusable:!1,ref:o},t),{},{className:"".concat(j?j+" ":"").concat(c,"-icon ").concat(c,"-icon-refresh")});return h&&(d.className="".concat(d.className," ").concat(c,"-icon-loading")),delete d.spin,delete d.isIcon,P.createElement("svg",H({fill:"none",stroke:"currentColor",strokeWidth:"4",viewBox:"0 0 48 48"},d),P.createElement("path",{d:"M38.837 18C36.463 12.136 30.715 8 24 8 15.163 8 8 15.163 8 24s7.163 16 16 16c7.455 0 13.72-5.1 15.496-12M40 8v10H30"}))}var _=P.forwardRef(te);_.defaultProps={isIcon:!0};_.displayName="IconRefresh";const{Option:b}=R,p=k.Item;function de(){const[t]=k.useForm(),[o,r]=i.useState(!1),[n,c]=i.useState([]),[h,j]=i.useState([]),[d,w]=i.useState(!1),[l,E]=i.useState(null),[F,q]=i.useState(""),[ae,z]=i.useState(""),[S,D]=i.useState("all"),[m,I]=i.useState({current:1,pageSize:10,total:0}),g=async(s={})=>{try{r(!0);const{current:a,pageSize:x}=m,v=await y.getAllUsers({page:a,pageSize:x,search:F,role:S==="all"?void 0:S,...s});c(v.data.users||[]),I({...v.data.pagination})}catch(a){console.log(a)}finally{r(!1)}};i.useEffect(()=>{g()},[]);const K=(s,a)=>{I({...m,current:s,pageSize:a}),g({page:s,pageSize:a})},B=async()=>{if(h.length===0){f.warning("请选择要重置密码的用户");return}try{await Promise.all(h.map(s=>y.resetUserPassword(s))),f.success("密码重置成功"),j([])}catch(s){console.log(s)}},L=async s=>{try{await y.deleteUser(s),f.success("删除成功"),g()}catch(a){console.log(a)}},M=(s,a)=>{let x={};for(let v of a)x[v]=s;z(x),q(s)},T=async s=>{try{l?(await y.updateUser({id:l.id,...s}),f.success("更新成功")):(await y.createUser(s),f.success("创建成功")),w(!1),t.resetFields(),g()}catch{f.error(l?"更新失败":"创建失败")}},V=[{title:"序号",render:(s,a,x)=>x+1},{title:"id",dataIndex:"id"},{title:"昵称",dataIndex:"nickname"},{title:"用户名",dataIndex:"username"},{title:"邮箱",dataIndex:"email"},{title:"头像",dataIndex:"avatar",render:s=>e.jsx("img",{src:s,alt:"avatar",style:{width:"40px",height:"40px",borderRadius:"50%"}})},{title:"角色",dataIndex:"user_role",render:s=>s==="admin"?"管理员":"普通用户"},{title:"注册时间",dataIndex:"created_at",render:s=>Q(s)},{title:"操作",render:(s,a)=>e.jsxs(O,{children:[e.jsx(C,{type:"text",size:"small",icon:e.jsx(X,{}),onClick:()=>{E(a),t.setFieldsValue(a),w(!0)},children:"编辑"}),e.jsx(Z,{title:"确定要删除该用户吗？",onOk:()=>L(a.id),children:e.jsx(C,{type:"text",status:"danger",size:"small",icon:e.jsx(Y,{}),children:"删除"})})]})}];return e.jsxs("div",{className:"user-manage",children:[e.jsxs($,{title:"用户管理",extra:e.jsxs(O,{children:[e.jsx(C,{type:"primary",icon:e.jsx(G,{}),onClick:()=>{E(null),t.resetFields(),w(!0)},children:"新增用户"}),e.jsx(C,{type:"primary",status:"warning",icon:e.jsx(_,{}),disabled:h.length===0,onClick:B,children:"批量重置密码"}),e.jsx(C,{type:"primary",onClick:()=>g(),children:"刷新列表"})]}),children:[e.jsx("div",{className:"search-bar",children:e.jsxs(O,{children:[e.jsx(u.Search,{placeholder:"搜索名称/昵称/邮箱",style:{width:300},value:F,onChange:s=>M(s,["nickname","email"]),prefix:e.jsx(J,{})}),e.jsxs(R,{placeholder:"角色筛选",style:{width:120},value:S,onChange:s=>{D(s),I({...m,current:1})},children:[e.jsx(b,{value:"all",children:"全部角色"}),e.jsx(b,{value:"admin",children:"管理员"}),e.jsx(b,{value:"user",children:"普通用户"})]})]})}),e.jsx(ee,{className:"scrollable-table",rowKey:"id",loading:o,columns:V,data:n,rowSelection:{selectedRowKeys:h,onChange:s=>j(s)},pagination:{sizeCanChange:!0,current:m.current,pageSize:m.pageSize,total:m.total,showTotal:!0,pageSizeChangeResetCurrent:!0,onChange:K}})]}),e.jsx(se,{title:l?"编辑用户":"新增用户",visible:d,onOk:()=>t.submit(),onCancel:()=>{w(!1),t.resetFields()},autoFocus:!1,focusLock:!0,children:e.jsxs(k,{form:t,onSubmit:T,labelCol:{span:6},wrapperCol:{span:16},children:[l&&e.jsxs(p,{label:"id",field:"id",initialValue:l==null?void 0:l.id,children:["  ",e.jsx(u,{disabled:!0,value:l==null?void 0:l.id})]}),e.jsx(p,{label:"用户名",field:"username",rules:[{required:!0,message:"请输入用户名"}],children:e.jsx(u,{placeholder:"请输入用户名"})}),e.jsx(p,{label:"昵称",field:"nickname",rules:[{required:!0,message:"请输入昵称"}],children:e.jsx(u,{placeholder:"请输入昵称"})}),e.jsx(p,{label:"头像url",field:"avatar",rules:[{required:!0,message:"请输入头像url"}],children:e.jsx(u,{placeholder:"请输入头像url"})}),e.jsx(p,{label:"邮箱",field:"email",rules:[{required:!0,message:"请输入邮箱"},{type:"email",message:"请输入正确的邮箱格式"}],children:e.jsx(u,{placeholder:"请输入邮箱"})}),!l&&e.jsx(p,{label:"密码",field:"password",rules:[{required:!0,message:"请输入密码"}],children:e.jsx(u.Password,{placeholder:"请输入密码"})}),e.jsx(p,{label:"角色",field:"user_role",rules:[{required:!0,message:"请选择角色"}],children:e.jsxs(R,{placeholder:"请选择角色",children:[e.jsx(b,{value:"user",children:"普通用户"}),e.jsx(b,{value:"admin",children:"管理员"})]})})]})})]})}export{de as default};
