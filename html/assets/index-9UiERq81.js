import{e as g,C as ae,u as se,ad as B,ae as O,f as te,j as ne,i as K,d as re,R as i,l as le,m as t,S as oe,J as p,n as V,L as ie,af as _,ag as ce,ah as T,ai as $,aj as ue,A as H,q as me,s as G,ak as pe,N as ge}from"./index-FD1T5Q2O.js";import{s as fe}from"./system-message-Did0skei.js";import{E as de}from"./modal-8NwfAtd_.js";import{L as q}from"./index-BFBZy68U.js";import"./Combination-C62u9g4Y.js";var y=function(){return y=Object.assign||function(r){for(var n,u=1,d=arguments.length;u<d;u++){n=arguments[u];for(var c in n)Object.prototype.hasOwnProperty.call(n,c)&&(r[c]=n[c])}return r},y.apply(this,arguments)},ve=function(r,n){var u=typeof Symbol=="function"&&r[Symbol.iterator];if(!u)return r;var d=u.call(r),c,w=[],l;try{for(;(n===void 0||n-- >0)&&!(c=d.next()).done;)w.push(c.value)}catch(b){l={error:b}}finally{try{c&&!c.done&&(u=d.return)&&u.call(d)}finally{if(l)throw l.error}}return w},J=function(r){return K(r)?r.reduce(function(n,u){return n+(u.span||1)},0):0},ye={layout:"horizontal",column:3,tableLayout:"auto"};function Q(r){var n,u=g.useContext(ae),d=u.getPrefixCls,c=u.componentConfig,w=u.rtl,l=se(r,ye,c==null?void 0:c.Descriptions),b=l.style,I=l.className,S=l.column,z=l.title,D=l.data,R=l.border,x=l.labelStyle,j=l.valueStyle,F=l.colon,M=l.layout,U=l.size,m=l.tableLayout,e=d("descriptions"),L=ve(g.useState(),2),N=L[0],f=L[1],h=g.useRef(null);g.useEffect(function(){return h.current=B.subscribe(function(s){for(var o=0;o<O.length;o++){var a=O[o];if(s[a]){f(a);break}}}),function(){B.unsubscribe(h.current)}},[]);var v=3;te(S)&&(v=S[N]||3),ne(S)&&S>0&&(v=S);var k=[];if(K(D)&&D.length>0&&v){D.forEach(function(s){var o=k[k.length-1],a=J(o);a===0?k.push([y(y({},s),{span:s.span?s.span>v?v:s.span:1})]):a===v?k.push([y(y({},s),{span:s.span?s.span>v?v:s.span:1})]):o.push(y(y({},s),{span:s.span?s.span+a>v?v-a:s.span:1}))});var P=k[k.length-1],A=J(P);A<v&&(P[P.length-1].span=P[P.length-1].span+v-A)}function W(s,o){return i.createElement(g.Fragment,{key:o},i.createElement("tr",{className:e+"-row"},s.map(function(a,C){var E=a.span>1?{colSpan:a.span}:{};return i.createElement("td",y({key:(a.key||C)+"_label",className:e+"-item-label"},E,{style:x}),a.label,F)})),i.createElement("tr",{className:e+"-row"},s.map(function(a,C){var E=a.span>1?{colSpan:a.span}:{};return i.createElement("td",y({key:(a.key||C)+"_value",className:e+"-item-value"},E,{style:j}),a.value)})))}function X(s,o){return i.createElement("tr",{key:o,className:e+"-row"},s.map(function(a,C){var E=a.span>1?{colSpan:a.span*2-1}:{};return i.createElement(g.Fragment,{key:a.key||C},i.createElement("td",{className:e+"-item-label",style:x},a.label,F),i.createElement("td",y({className:e+"-item-value"},E,{style:j}),a.value))}))}function Y(s,o){return i.createElement("tr",{key:o,className:e+"-row"},s.map(function(a,C){var E=a.span>1?{colSpan:a.span}:{};return i.createElement("td",y({key:a.key||C},E,{className:e+"-item"}),i.createElement("div",{className:e+"-item-label-inline",style:x},a.label,F),i.createElement("div",{className:e+"-item-value-inline",style:j},a.value))}))}function Z(s,o){return M==="inline-vertical"||M==="inline-horizontal"?Y(s,o):M==="vertical"?W(s,o):X(s,o)}var ee=re(e,(n={},n[e+"-border"]=R,n[e+"-layout-"+M]=M,n[e+"-size-"+U]=U,n[e+"-table-layout-fixed"]=m==="fixed",n[e+"-rtl"]=w,n),I);return i.createElement("div",{className:ee,style:b},z&&i.createElement("div",{className:e+"-title"},z),i.createElement("div",{className:e+"-body"},i.createElement("table",{className:e+"-table",cellPadding:0,cellSpacing:0},i.createElement("tbody",null,k.map(function(s,o){return Z(s,o)})))))}Q.displayName="Descriptions";function Me(){const{t:r}=le(),[n,u]=g.useState("systemMessage"),[d,c]=g.useState([]),[w,l]=g.useState(t.jsx(oe,{loading:!0})),[b,I]=g.useState(p.getState().user),[S,z]=g.useState([]),[D,R]=g.useState(!1),x=m=>{n==="systemMessage"?fe.getSystemMessages({page:m,pageSize:10}).then(e=>{const N=(e.data.sysMessage||[]).filter(f=>!d.some(h=>h.id===f.id));c(f=>[...f,...N]),e.data.sysMessage.length<10?l("No more data"):l("下拉获取更多数据")}):n==="softwareMessage"?G.getMyMessages({page:m,pageSize:10}).then(e=>{const N=(e.data.messages||[]).filter(f=>!d.some(h=>h.id===f.id));c(f=>[...f,...N]),e.data.messages.length<10?l("No more data"):l("下拉获取更多数据")}):n==="userFeedback"&&G.getUserFeedbackMessages({page:m,pageSize:10}).then(e=>{const N=(e.data.messages||[]).filter(f=>!d.some(h=>h.id===f.id));c(f=>[...f,...N]),e.data.messages.length<10?l("No more data"):l("下拉获取更多数据")})},j=(m,e)=>{I({...b,[e.target.name]:e.target.value})},F=async()=>{p.setState({user:b}),await pe.editUser(b),z([{label:"昵称",value:p.getState().user.nickname},{label:"用户名",value:p.getState().user.username},{label:"邮箱",value:p.getState().user.email},{label:"角色",value:p.getState().user.role},{label:"创建时间",value:p.getState().user.created_at}]),ge.success(r("消息更新成功")),R(!1)},M=()=>{I(p.getState().user),R(!1)};g.useEffect(()=>{c([]),x(1)},[n]),g.useEffect(()=>{x(1),p.getState().initializeUser(),I(p.getState().user),z([{label:"昵称",value:p.getState().user.nickname},{label:"用户名",value:p.getState().user.username},{label:"邮箱",value:p.getState().user.email},{label:"角色",value:p.getState().user.role},{label:"创建时间",value:p.getState().user.created_at}])},[]);const U=[{label:r("systemMessage"),value:"systemMessage"},{label:r("softwareMessage"),value:"softwareMessage"},{label:r("userFeedback"),value:"userFeedback"}];return t.jsxs("div",{className:"user-center-page",children:[t.jsxs(V,{className:"user-info",children:[t.jsx(Q,{colon:":",layout:"inline-horizontal",title:r("userInfo"),data:S}),t.jsx(ie,{type:"primary",onClick:()=>R(!0),style:{marginTop:"16px"},children:r("editUserInfo")})]}),t.jsx(de,{title:r("editUserInfo"),visible:D,onOk:F,onCancel:M,okText:r("save"),cancelText:r("cancel"),children:t.jsx(_,{layout:"vertical",children:t.jsxs(ce,{gutter:16,children:[t.jsx(T,{span:12,children:t.jsx(_.Item,{label:r("nickname"),children:t.jsx($,{name:"nickname",value:b.nickname,onChange:j})})}),t.jsx(T,{span:12,children:t.jsx(_.Item,{label:r("email"),children:t.jsx($,{name:"email",value:b.email,onChange:j})})}),t.jsx(T,{span:12,children:t.jsx(_.Item,{label:r("avatar"),children:t.jsx($,{name:"avatar",value:b.avatar,onChange:j})})})]})})}),t.jsxs(V,{className:"user-message",children:[t.jsx(ue.Group,{type:"button",name:"direction",value:n,onChange:u,options:U}),t.jsx(q,{style:{maxHeight:400},scrollLoading:w,onReachBottom:m=>x(m),bordered:!1,dataSource:d,render:(m,e)=>t.jsx(q.Item,{className:"message-item",children:n==="systemMessage"||n==="userFeedback"?t.jsx(q.Item.Meta,{avatar:t.jsx(H,{shape:"square",children:t.jsx("img",{alt:"avatar",src:m.avatar})}),title:`${m.nickname}`,description:m.message_text}):t.jsx(q.Item.Meta,{avatar:t.jsx(H,{shape:"square",children:t.jsx("img",{alt:"avatar",src:`${me}/${m.app_icon}`})}),title:`${m.app_package_name} - ${m.app_name}`,description:m.message_text})},e)})]})]})}export{Me as default};
