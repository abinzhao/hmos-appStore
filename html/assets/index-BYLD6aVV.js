import{af as s,e as o,m as e,n as O,L as m,aa as D,N as x,G as i,ai as t,O as f,Q as K,ap as L,t as j,au as B,ar as G,av as U}from"./index-FD1T5Q2O.js";import{S as v,P as J}from"./index-DV0-gRm5.js";import{I as F}from"./index-6It838eS.js";import{T as Q}from"./index-BZ7AmgX9.js";import{T as H}from"./index-Bw-ri7r9.js";import{E as W}from"./modal-8NwfAtd_.js";import"./Combination-C62u9g4Y.js";import"./index-B1gdGVBm.js";import"./b-tween.es-BtQQsX34.js";const{Option:_}=f,n=s.Item;function re(){const[p]=s.useForm(),[k,b]=o.useState(!1),[A,z]=o.useState([]),[E,M]=o.useState([]),[R,c]=o.useState(!1),[r,y]=o.useState(null),[P]=o.useState(""),[g]=o.useState("all"),[h,C]=o.useState({current:1,pageSize:10,total:0}),[w]=s.useForm(),I=[{title:"已上架",value:"3"},{title:"待上架",value:"2"},{title:"审核中",value:"1"}],u=async(a={})=>{try{b(!0);const{current:l,pageSize:d}=h,S=await j.getUserApps({page:l||1,pageSize:d,keyword:w.getFieldsValue(),role:g==="all"?void 0:g,...a});z(S.apps||[]),C({...S.pagination})}catch(l){console.log(l)}finally{b(!1)}};o.useEffect(()=>{u()},[P,g]);const T=(a,l)=>{C({...h,current:a,pageSize:l}),u({page:a,pageSize:l})},V=async a=>{try{await j.removeApp(a),x.success("删除成功"),u()}catch(l){console.log(l)}},q=async a=>{try{r?(await j.updateUserApp({id:r.id,...a}),x.success("更新成功")):(await j.setApp(a),x.success("创建成功")),c(!1),p.resetFields(),u()}catch(l){console.log((r?"更新失败":"创建失败")+" error: "+l)}},N=[{title:"序号",width:80,render:(a,l,d)=>d+1},{title:"id",dataIndex:"id",width:50},{title:"上传用户",dataIndex:"nickname",width:120},{title:"包名",dataIndex:"app_package_name",width:120},{title:"软件名",dataIndex:"app_name",width:120},{title:"软件描述",dataIndex:"app_description",width:200},{title:"应用分类",dataIndex:"app_category",width:200},{title:"软件版本",dataIndex:"app_version",width:100},{title:"审核状态",width:100,dataIndex:"application_status",render:a=>{for(const l of I)if(a===l.value)return l.title;return"未定义的值"}},{title:"软件图标",dataIndex:"app_icon",width:230},{title:"软件截图",dataIndex:"app_screenshot",width:230},{title:"软件地址",dataIndex:"app_file_url",width:230},{title:"发布时间",dataIndex:"created_at",width:100,render:a=>B(a)},{title:"操作",fixed:"left",render:(a,l)=>e.jsxs(v,{children:[e.jsx(m,{type:"text",size:"small",icon:e.jsx(G,{}),onClick:()=>{if(l.application_status!=="1"){x.error("该应用已经进入审核阶段，无法编辑");return}y({...l}),p.setFieldsValue({...l}),c(!0)},children:"编辑"}),e.jsx(J,{title:"确定要删除该应用吗？",onOk:()=>V(l.id),children:e.jsx(m,{type:"text",status:"danger",size:"small",icon:e.jsx(U,{}),children:"删除"})})]})}];return e.jsxs("div",{className:"app-manage",children:[e.jsxs(O,{title:"应用管理",style:{marginBottom:16},extra:e.jsxs(v,{children:[e.jsx(m,{type:"primary",icon:e.jsx(D,{}),onClick:()=>{y(void 0),p.resetFields(),c(!0)},children:"新增应用"}),e.jsx(m,{type:"primary",onClick:()=>u(),children:"刷新列表"})]}),children:[e.jsx("div",{className:"search-bar",children:e.jsxs(s.Provider,{onFormValuesChange:()=>{},onFormSubmit:(a,l,d)=>{a==="modalForm"&&(d.forms.searchForm.setFieldsValue({email:l.email}),c(!1)),x.info({icon:e.jsx("span",{}),content:e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx("span",{children:"form values:"}),e.jsx("pre",{children:JSON.stringify({...d.forms.searchForm.getFieldsValue(),...d.forms.refreshForm.getFieldsValue()},null,2)})]})})},children:[e.jsxs(s,{id:"searchForm",layout:"vertical",form:w,children:[e.jsxs(i.Row,{gutter:24,children:[e.jsx(i.Col,{span:6,children:e.jsx(s.Item,{label:"包名称",field:"app_package_name",children:e.jsx(t,{placeholder:"包名称"})})}),e.jsx(i.Col,{span:6,children:e.jsx(s.Item,{label:"应用名称",field:"app_name",children:e.jsx(t,{placeholder:"应用名称"})})}),e.jsx(i.Col,{span:6,children:e.jsx(s.Item,{label:"发布者",field:"user_id",children:e.jsx(t,{placeholder:"发布者"})})}),e.jsx(i.Col,{span:6,children:e.jsx(s.Item,{label:"描述",field:"app_description",children:e.jsx(t,{placeholder:"描述"})})})]}),e.jsxs(i.Row,{gutter:24,children:[e.jsx(i.Col,{span:6,children:e.jsx(s.Item,{label:"应用类别",field:"app_category",children:e.jsx(t,{placeholder:"应用类别"})})}),e.jsx(i.Col,{span:6,children:e.jsx(s.Item,{label:"应用状态",field:"application_status",children:e.jsx(f,{placeholder:"Select",style:{width:154},allowClear:!0,children:I.map((a,l)=>e.jsx(_,{value:a.value,children:a.title},l))})})}),e.jsx(i.Col,{span:6,children:e.jsx(s.Item,{label:"最小下载量",field:"min_install_count",children:e.jsx(F,{placeholder:"最小下载量"})})}),e.jsx(i.Col,{span:6,children:e.jsx(s.Item,{label:"最大下载量",field:"max_install_count",children:e.jsx(F,{placeholder:"最大下载量"})})})]})]}),e.jsx(i.Row,{justify:"space-between",align:"center",children:e.jsx(Q.Text,{style:{fontSize:18},bold:!0,children:"Result"})})]})}),e.jsx("div",{className:"table-container",children:e.jsx(H,{rowKey:"id",loading:k,columns:N,data:A,scroll:{x:"1500px"},rowSelection:{selectedRowKeys:E,onChange:a=>M(a)},pagePosition:"br",pagination:{sizeCanChange:!0,current:h.current,pageSize:h.pageSize,total:h.total,showTotal:!0,pageSizeChangeResetCurrent:!0,onChange:T}})})]}),e.jsx(W,{title:r?"编辑应用":"新增应用",visible:R,onOk:()=>p.submit(),onCancel:()=>{c(!1),p.resetFields()},autoFocus:!1,focusLock:!0,children:e.jsxs(s,{form:p,onSubmit:q,labelCol:{span:6},wrapperCol:{span:16},children:[r&&e.jsxs(n,{label:"id",field:"id",children:["  ",e.jsx(t,{disabled:!0,value:r==null?void 0:r.id})]}),e.jsx(n,{label:"包名",field:"app_package_name",rules:[{required:!0,message:"请输入消息"}],children:e.jsx(t,{placeholder:"请输入消息"})}),e.jsx(n,{label:"App名称",field:"app_name",rules:[{required:!0,message:"请输入消息"}],children:e.jsx(t,{placeholder:"请输入消息"})}),e.jsx(n,{label:"App介绍",field:"app_description",rules:[{required:!0,message:"请输入消息"}],children:e.jsx(t,{placeholder:"请输入消息"})}),e.jsx(n,{label:"App分类",field:"app_category",required:!0,children:e.jsx(f,{placeholder:"请选择分类",children:K.map((a,l)=>e.jsx(_,{value:a.value,children:a.label},l))})}),e.jsx(n,{label:"发布类型",field:"publish_type",required:!0,children:e.jsx(f,{placeholder:"请选择发布类型",value:r==null?void 0:r.publish_type,children:L.map((a,l)=>e.jsx(_,{value:a.value,children:a.label},l))})}),e.jsx(n,{label:"App版本号",field:"app_version",children:e.jsx(t,{placeholder:"请输入消息"})}),e.jsx(n,{label:"App图标",field:"app_icon",children:e.jsx(t,{placeholder:"请输入消息"})}),e.jsx(n,{label:"App截图",field:"app_screenshot",children:e.jsx(t,{placeholder:"请输入消息"})}),e.jsx(n,{label:"应用包",field:"app_file_url",children:e.jsx(t,{placeholder:"请输入消息"})})]})})]})}export{re as default};
