import{af as s,e as o,m as e,n as O,L as j,aa as D,N as f,G as i,ai as t,O as m,Q as K,ap as L,t as g,au as B,ar as G,av as J}from"./index-FD1T5Q2O.js";import{S,P as Q}from"./index-DV0-gRm5.js";import{I as F}from"./index-6It838eS.js";import{T as H}from"./index-BZ7AmgX9.js";import{T as U}from"./index-Bw-ri7r9.js";import{E as W}from"./modal-8NwfAtd_.js";import"./Combination-C62u9g4Y.js";import"./index-B1gdGVBm.js";import"./b-tween.es-BtQQsX34.js";const{Option:p}=m,n=s.Item;function re(){const[c]=s.useForm(),[k,b]=o.useState(!1),[A,z]=o.useState([]),[E,M]=o.useState([]),[R,h]=o.useState(!1),[r,y]=o.useState(null),[q]=o.useState(""),[_]=o.useState("all"),[u,C]=o.useState({current:1,pageSize:10,total:0}),[w]=s.useForm(),I=[{title:"已上架",value:"3"},{title:"待上架",value:"2"},{title:"审核中",value:"1"}],x=async(l={})=>{try{b(!0);const{current:a,pageSize:d}=u,v=await g.getAdminApps({page:a||1,pageSize:d,keyword:w.getFieldsValue(),role:_==="all"?void 0:_,...l});z(v.apps||[]),C({...v.pagination})}catch(a){console.log(a)}finally{b(!1)}};o.useEffect(()=>{x()},[q,_]);const P=(l,a)=>{C({...u,current:l,pageSize:a}),x({page:l,pageSize:a})},T=async l=>{try{await g.removeApp(l),f.success("删除成功"),x()}catch(a){console.log(a)}},V=async l=>{try{r?(await g.updateApp({id:r.id,...l}),f.success("更新成功")):(await g.setApp(l),f.success("创建成功")),h(!1),c.resetFields(),x()}catch(a){console.log((r?"更新失败":"创建失败")+" error: "+a)}},N=[{title:"序号",width:80,render:(l,a,d)=>d+1},{title:"id",dataIndex:"id",width:50},{title:"上传用户",dataIndex:"nickname",width:120},{title:"包名",dataIndex:"app_package_name",width:120},{title:"软件名",dataIndex:"app_name",width:120},{title:"软件描述",dataIndex:"app_description",width:200},{title:"应用分类",dataIndex:"app_category",width:200},{title:"软件版本",dataIndex:"app_version",width:100},{title:"审核状态",width:100,dataIndex:"application_status",render:l=>{for(const a of I)if(l===a.value)return a.title;return"未定义的值"}},{title:"软件图标",dataIndex:"app_icon",width:230},{title:"软件截图",dataIndex:"app_screenshot",width:230},{title:"软件地址",dataIndex:"app_file_url",width:230},{title:"发布时间",dataIndex:"created_at",width:100,render:l=>B(l)},{title:"操作",fixed:"left",render:(l,a)=>e.jsxs(S,{children:[e.jsx(j,{type:"text",size:"small",icon:e.jsx(G,{}),onClick:()=>{console.log("record",a),y({...a}),c.setFieldsValue({...a}),h(!0)},children:"编辑"}),e.jsx(Q,{title:"确定要删除该应用吗？",onOk:()=>T(a.id),children:e.jsx(j,{type:"text",status:"danger",size:"small",icon:e.jsx(J,{}),children:"删除"})})]})}];return e.jsxs("div",{className:"app-manage",children:[e.jsxs(O,{title:"应用管理",style:{marginBottom:16},extra:e.jsxs(S,{children:[e.jsx(j,{type:"primary",icon:e.jsx(D,{}),onClick:()=>{y(void 0),c.resetFields(),h(!0)},children:"新增应用"}),e.jsx(j,{type:"primary",onClick:()=>x(),children:"刷新列表"})]}),children:[e.jsx("div",{className:"search-bar",children:e.jsxs(s.Provider,{onFormValuesChange:()=>{},onFormSubmit:(l,a,d)=>{l==="modalForm"&&(d.forms.searchForm.setFieldsValue({email:a.email}),h(!1)),f.info({icon:e.jsx("span",{}),content:e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx("span",{children:"form values:"}),e.jsx("pre",{children:JSON.stringify({...d.forms.searchForm.getFieldsValue(),...d.forms.refreshForm.getFieldsValue()},null,2)})]})})},children:[e.jsxs(s,{id:"searchForm",layout:"vertical",form:w,children:[e.jsxs(i.Row,{gutter:24,children:[e.jsx(i.Col,{span:6,children:e.jsx(s.Item,{label:"包名称",field:"app_package_name",children:e.jsx(t,{placeholder:"包名称"})})}),e.jsx(i.Col,{span:6,children:e.jsx(s.Item,{label:"应用名称",field:"app_name",children:e.jsx(t,{placeholder:"应用名称"})})}),e.jsx(i.Col,{span:6,children:e.jsx(s.Item,{label:"发布者",field:"user_id",children:e.jsx(t,{placeholder:"发布者"})})}),e.jsx(i.Col,{span:6,children:e.jsx(s.Item,{label:"描述",field:"app_description",children:e.jsx(t,{placeholder:"描述"})})})]}),e.jsxs(i.Row,{gutter:24,children:[e.jsx(i.Col,{span:6,children:e.jsx(s.Item,{label:"应用类别",field:"app_category",children:e.jsx(t,{placeholder:"应用类别"})})}),e.jsx(i.Col,{span:6,children:e.jsx(s.Item,{label:"应用状态",field:"application_status",children:e.jsx(m,{placeholder:"Select",style:{width:154},allowClear:!0,children:I.map((l,a)=>e.jsx(p,{value:l.value,children:l.title},a))})})}),e.jsx(i.Col,{span:6,children:e.jsx(s.Item,{label:"最小下载量",field:"min_install_count",children:e.jsx(F,{placeholder:"最小下载量"})})}),e.jsx(i.Col,{span:6,children:e.jsx(s.Item,{label:"最大下载量",field:"max_install_count",children:e.jsx(F,{placeholder:"最大下载量"})})})]})]}),e.jsx(i.Row,{justify:"space-between",align:"center",children:e.jsx(H.Text,{style:{fontSize:18},bold:!0,children:"Result"})})]})}),e.jsx("div",{className:"table-container",children:e.jsx(U,{rowKey:"id",loading:k,columns:N,data:A,scroll:{x:"1500px"},rowSelection:{selectedRowKeys:E,onChange:l=>M(l)},pagePosition:"br",pagination:{sizeCanChange:!0,current:u.current,pageSize:u.pageSize,total:u.total,showTotal:!0,pageSizeChangeResetCurrent:!0,onChange:P}})})]}),e.jsx(W,{title:r?"编辑应用":"新增应用",visible:R,onOk:()=>c.submit(),onCancel:()=>{h(!1),c.resetFields()},autoFocus:!1,focusLock:!0,children:e.jsxs(s,{form:c,onSubmit:V,labelCol:{span:6},wrapperCol:{span:16},children:[r&&e.jsxs(n,{label:"id",field:"id",children:["  ",e.jsx(t,{disabled:!0,value:r==null?void 0:r.id})]}),e.jsx(n,{label:"包名",field:"app_package_name",rules:[{required:!0,message:"请输入消息"}],children:e.jsx(t,{placeholder:"请输入消息"})}),e.jsx(n,{label:"App名称",field:"app_name",rules:[{required:!0,message:"请输入消息"}],children:e.jsx(t,{placeholder:"请输入消息"})}),e.jsx(n,{label:"App介绍",field:"app_description",rules:[{required:!0,message:"请输入消息"}],children:e.jsx(t,{placeholder:"请输入消息"})}),e.jsx(n,{label:"App分类",field:"app_category",required:!0,children:e.jsx(m,{placeholder:"请选择分类",children:K.map((l,a)=>e.jsx(p,{value:l.value,children:l.label},a))})}),e.jsx(n,{label:"发布类型",field:"publish_type",required:!0,children:e.jsx(m,{placeholder:"请选择发布类型",value:r==null?void 0:r.publish_type,children:L.map((l,a)=>e.jsx(p,{value:l.value,children:l.label},a))})}),e.jsx(n,{label:"App版本号",field:"app_version",children:e.jsx(t,{placeholder:"请输入消息"})}),e.jsx(n,{label:"App图标",field:"app_icon",children:e.jsx(t,{placeholder:"请输入消息"})}),e.jsx(n,{label:"App截图",field:"app_screenshot",children:e.jsx(t,{placeholder:"请输入消息"})}),e.jsx(n,{label:"应用包",field:"app_file_url",children:e.jsx(t,{placeholder:"请输入消息"})}),e.jsx(n,{label:"审核状态",field:"application_status",rules:[{required:!0,message:"请输入消息"}],children:e.jsxs(m,{placeholder:"请选择状态",children:[e.jsx(p,{value:"3",children:"已上架"}),e.jsx(p,{value:"2",children:"待上架"}),e.jsx(p,{value:"1",children:"待审核"})]})})]})})]})}export{re as default};
